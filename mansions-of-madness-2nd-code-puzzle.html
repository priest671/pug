<!DOCTYPE html><html><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, viewport-fit=cover, user-scalable=no"><title>瘋狂詭宅第二版 代碼謎題</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-39556213-3"></script><script>window.dataLayer = window.dataLayer || []
function gtag () { dataLayer.push(arguments) } // eslint-disable-line
gtag('js', new Date())
gtag('config', 'UA-39556213-3')</script><script>(function () {
  const hostname = location.host.split(':')[0]
  if (hostname === 'localhost') document.write(`<script src="http://${hostname}:35729/livereload.js?snipver=1"></` + 'script>')
})()</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-default@3/default.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1/themes/prism-tomorrow.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@9/dist/sweetalert2.min.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&amp;display=swap"><style>[v-cloak] {
  display: none; }

body, .h1, .h2, .h3, .h4, .h5, .h6, h1, h2, h3, h4, h5, h6 {
  font-family: 'Noto Sans TC', sans-serif; }
</style></head><body><div class="container" id="app" v-cloak><h3 class="text-center my-3">瘋狂詭宅第二版 代碼謎題</h3><div class="row"><div class="col-sm"><div class="card mb-3"><h5 class="card-header"><i class="fa fa-fw fa-gamepad"></i> 代碼謎題</h5><div class="card-body"><div class="form-group"><label for="i-num">有幾個數字、幾個格子？</label><div class="dropdown"><button class="btn btn-block btn-primary dropdown-toggle" type="button" data-toggle="dropdown"><span class="fa fa-fw fa-key"></span> {{ i.num }} 種數字 {{ i.slot }} 個格子&nbsp;</button><div class="dropdown-menu"><template v-for="n in [3,4,5,6]"><button class="dropdown-item" type="button" v-for="s in [3,4,5,6]" :class="{active: (n === i.num &amp;&amp; s === i.slot)}" @click="(n !== i.num || s !== i.slot) &amp;&amp; btnSetNumSlot(n, s)">{{ n }} 種數字 {{ s }} 個格子</button></template></div></div></div><div class="form-group"><label for="i-guess">請輸入 {{ i.slot }} 位數 1 到 {{ i.num }} 的數字 (可重複)</label><div class="input-group input-group-sm mb-2" :class="getGuessClass(i.guess)"><div class="input-group-prepend"><span class="input-group-text">{{ i.guesses.length + 1 }}</span></div><input class="form-control" id="i-guess" type="text" inputmode="numeric" :maxlength="i.slot" v-model="i.guess" @keyup.enter="btnPushGuess" :class="getGuessClass(i.guess)"><div class="input-group-append"><button class="btn btn-success" type="button" @click="btnPushGuess">送出</button></div></div></div><table class="table table-sm table-bordered text-center mb-0" v-if="i.guesses.length"><thead><tr><th>#</th><th>猜測數字</th><th colspan="2">結果</th></tr></thead><tbody class="text-monospace"><tr v-for="(guess, guessId) in i.guesses"><template v-for="simi in [calcSimilarity(guess, i.answer)]"><th>{{ guessId + 1 }}</th><td>{{ guess }}</td><td>{{ similarityToStr[simi] }}</td><td><a class="badge badge-info mr-1" @click="btnPushSolver(guess, simi)" href="#">求解</a></td></template></tr></tbody></table></div><div class="card-footer text-right"><button class="btn btn-sm btn-danger" type="button" @click="btnNewGame(false)"><span class="fa fa-fw fa-trash-o"></span> 開新遊戲</button></div></div></div><div class="col-sm"><div class="card mb-3"><h5 class="card-header"><i class="fa fa-fw fa-graduation-cap"></i> 代碼謎題求解程式</h5><div class="card-body"><div class="form-group"><label>請輸入猜測數字與結果</label><div class="input-group input-group-sm mb-2" v-for="(solver, solverId) in i.solvers" :class="getGuessClass(solver.guess)"><div class="input-group-prepend"><span class="input-group-text">{{ solverId + 1 }}</span></div><input class="form-control" type="text" inputmode="numeric" :maxlength="i.slot" v-model="solver.guess" :class="getGuessClass(solver.guess)"><div class="input-group-append"><button class="btn btn-outline-secondary dropdown-toggle" type="button" data-toggle="dropdown">{{ similarityToStr[solver.simi] }}</button><div class="dropdown-menu dropdown-menu-right"><button class="dropdown-item" type="button" v-for="simi in similarity" :class="{active: simi === solver.simi}" @click="solver.simi = simi">{{ similarityToStr[simi] }}</button></div></div></div></div><div class="form-group mb-0"><label>可能的謎底 <span class="badge badge-pill badge-success">{{ possibilities.length }}</span></label><small class="form-text text-muted" v-if="!possibilities.length">請輸入猜測數字與結果來顯示可能的謎底</small><small class="form-text text-muted" v-if="possibilities.length &gt; 100">僅顯示前 100 筆可能的謎底</small><div id="possibilities"><a class="badge badge-info mr-1" v-for="possible in possibilities.slice(0, 100)" @click="i.guess = possible" href="#">{{ possible }}</a></div></div></div><div class="card-footer text-right"><button class="btn btn-sm btn-danger" type="button" @click="btnNewSolver(false)"><span class="fa fa-fw fa-trash-o"></span> 重新求解</button></div></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script><script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/json5@2/dist/index.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lodash@4/lodash.min.js"></script><script src="https://cdn.jsdelivr.net/npm/papaparse@5/papaparse.min.js"></script><script src="https://cdn.jsdelivr.net/npm/popper.js@1/dist/umd/popper.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-core.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1/plugins/autoloader/prism-autoloader.min.js"></script><script src="https://cdn.jsdelivr.net/npm/qs@6/dist/qs.min.js"></script><script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script><script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.min.js"></script><!-- bootstrap require jquery and pupper--><script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js"></script><script>const SIMILARITY = {
  2: [0, 1, 2, 10, 20],
  3: [0, 1, 2, 3, 10, 11, 12, 20, 30],
  4: [0, 1, 2, 3, 4, 10, 11, 12, 13, 20, 21, 22, 30, 40],
  5: [0, 1, 2, 3, 4, 5, 10, 11, 12, 13, 14, 20, 21, 22, 23, 30, 31, 32, 40, 50],
  6: [0, 1, 2, 3, 4, 5, 6, 10, 11, 12, 13, 14, 15, 20, 21, 22, 23, 24, 30, 31, 32, 33, 40, 41, 42, 50, 60],
}
window.vm = new Vue({
  el: '#app',
  data: {
    i: {
      answer: '',
      guess: '',
      guesses: [],
      num: 3,
      slot: 3,
      solvers: [],
    },
    similarityToStr: {
      0: '0A0B',
      1: '0A1B',
      2: '0A2B',
      3: '0A3B',
      4: '0A4B',
      5: '0A5B',
      6: '0A6B',
      10: '1A0B',
      11: '1A1B',
      12: '1A2B',
      13: '1A3B',
      14: '1A4B',
      15: '1A5B',
      20: '2A0B',
      21: '2A1B',
      22: '2A2B',
      23: '2A3B',
      24: '2A4B',
      30: '3A0B',
      31: '3A1B',
      32: '3A2B',
      33: '3A3B',
      40: '4A0B',
      41: '4A1B',
      42: '4A2B',
      50: '5A0B',
      60: '6A0B',
    },
  },
  mounted () {
    // 自動儲存功能
    try {
      const saved = JSON5.parse(localStorage.getItem(location.pathname))
      if (saved) this.$set(this, 'i', { ...this.i, ...saved })
    } catch (err) {}
    this.$watch('i', () => {
      localStorage.setItem(location.pathname, JSON5.stringify(this.i))
    }, { deep: true })

    // 初始化
    if (!this.verifyGuess(this.i.answer)) this.btnNewGame(true)
    if (!this.i.solvers.length) this.btnNewSolver(true)
  },
  computed: {
    digits () {
      return '123456'.slice(0, this.i.num)
    },
    similarity () {
      return SIMILARITY[this.i.slot]
    },
    possibilities () {
      const solvers = _.filter(this.i.solvers, solver => this.verifyGuess(solver.guess) && _.hasIn(this.similarityToStr, solver.simi))
      if (!solvers.length) return []
      const possibilities = []
      const genPossibilities = (prefix = '', size = 0) => {
        if (size < this.i.slot) return _.each(this.digits, (c, i) => genPossibilities(prefix + c, size + 1))
        let isPossible = true
        for (const solver of solvers) {
          if (this.calcSimilarity(prefix, solver.guess) === solver.simi) continue
          isPossible = false
          break
        }
        if (isPossible) possibilities.push(prefix)
      }
      genPossibilities()
      return possibilities
    },
  },
  methods: {
    verifyGuess (guess) {
      if (!_.isString(guess) || guess.length !== this.i.slot) return false
      for (let i = 0; i < guess.length; i++) { if (!_.inRange(guess[i], 1, this.i.num + 1)) return false }
      return true
    },
    getGuessClass (guess) {
      if (!_.isString(guess) || !guess.length) return ''
      return this.verifyGuess(guess) ? 'is-valid' : 'is-invalid'
    },
    calcSimilarity (guess, answer) {
      let a = 0
      const digits = _.times(6, () => [0, 0])
      for (let i = 0; i < guess.length; i++) {
        if (guess[i] === answer[i]) a++
        digits[guess[i] - 1][0]++
        digits[answer[i] - 1][1]++
      }
      return _.sumBy(digits, digit => _.min(digit)) + 9 * a
    },
    btnPushGuess () {
      const guess = this.i.guess
      if (!this.verifyGuess(guess)) return
      if (_.includes(this.i.guesses, guess)) return
      this.i.guesses.push(guess)
      this.i.guess = ''
    },
    async btnSetNumSlot (num, slot, force = false) {
      if (!force && !await this.confirm(`將代碼謎題調整為「${num} 種數字 ${slot} 個格子」嗎？`)) return
      this.i.num = num
      this.i.slot = slot
      this.btnNewGame(true)
      this.btnNewSolver(true)
    },
    async btnNewGame (force = false) {
      if (!force && !await this.confirm('是否開始新的代碼謎題？')) return
      this.i.answer = _.times(this.i.slot, () => _.sample(this.digits)).join('')
      this.i.guess = ''
      this.i.guesses = []
    },
    async btnNewSolver (force = false) {
      if (!force && !await this.confirm('是否清空求解資料？')) return
      this.$set(this.i, 'solvers', _.times(9, i => ({
        guess: '',
        simi: 0,
      })))
    },
    async btnPushSolver (guess, simi) {
      const solver = _.find(this.i.solvers, solver => !this.verifyGuess(solver.guess))
      if (!solver) return
      solver.guess = guess
      solver.simi = simi
    },
    async confirm (message, yes = '是', no = '否') {
      const confirm = await Swal.fire({
        cancelButtonColor: '#3085d6',
        cancelButtonText: no,
        confirmButtonColor: '#d33',
        confirmButtonText: yes,
        icon: 'question',
        showCancelButton: true,
        text: message,
      })
      return !!confirm.value
    },
  },
})</script></body></html>