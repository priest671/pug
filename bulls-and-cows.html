<!DOCTYPE html><html><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, viewport-fit=cover, user-scalable=no"><title>猜數字 Bulls And Cows</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-39556213-3"></script><script>window.dataLayer = window.dataLayer || []
function gtag () { dataLayer.push(arguments) } // eslint-disable-line
gtag('js', new Date())
gtag('config', 'UA-39556213-3')</script><script>(function () {
  const hostname = location.host.split(':')[0]
  if (hostname === 'localhost') document.write(`<script src="http://${hostname}:35729/livereload.js?snipver=1"></` + 'script>')
})()</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-default@3/default.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1/themes/prism-tomorrow.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@9/dist/sweetalert2.min.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&amp;display=swap"><style>[v-cloak] {
  display: none; }

body, .h1, .h2, .h3, .h4, .h5, .h6, h1, h2, h3, h4, h5, h6 {
  font-family: 'Noto Sans TC', sans-serif; }
</style></head><body><div class="container" id="app" v-cloak><h3 class="text-center my-3">猜數字 Bulls And Cows</h3><div class="row"><div class="col-sm"><div class="card mb-3"><h5 class="card-header"><i class="fa fa-fw fa-gamepad"></i> 猜數字遊戲</h5><div class="card-body"><div class="form-group"><label for="i-guess">請輸入四位數不重複 0 到 9 的數字</label><div class="input-group input-group-sm mb-2"><div class="input-group-prepend"><span class="input-group-text">{{ i.guesses.length + 1 }}</span></div><input class="form-control" id="i-guess" type="text" inputmode="numeric" maxlength="4" v-model="i.guess" @keyup.enter="btnPushGuess"><div class="input-group-append"><button class="btn btn-success" type="button" @click="btnPushGuess">送出</button></div></div></div><table class="table table-sm table-bordered text-center mb-0" v-if="i.guesses.length"><thead><tr><th>#</th><th>猜測數字</th><th colspan="2">結果</th></tr></thead><tbody class="text-monospace"><tr v-for="(guess, guessId) in i.guesses"><template v-for="simi in [calcSimilarity(guess, i.answer)]"><th>{{ guessId + 1 }}</th><td>{{ guess }}</td><td>{{ similarity.toStr[simi] }}</td><td><a class="badge badge-info mr-1" @click="btnPushSolver(guess, simi)" href="#">求解</a></td></template></tr></tbody></table></div><div class="card-footer text-right"><button class="btn btn-sm btn-danger" type="button" @click="btnNewGame(false)"><span class="fa fa-fw fa-trash-o"></span> 開新遊戲</button></div></div></div><div class="col-sm"><div class="card mb-3"><h5 class="card-header"><i class="fa fa-fw fa-graduation-cap"></i> 猜數字求解程式</h5><div class="card-body"><div class="form-group"><label>請輸入猜測數字與結果</label><div class="input-group input-group-sm mb-2" v-for="(solver, solverId) in i.solvers"><div class="input-group-prepend"><span class="input-group-text">{{ solverId + 1 }}</span></div><input class="form-control" type="text" inputmode="numeric" maxlength="4" v-model="solver.guess"><div class="input-group-append"><button class="btn btn-outline-secondary dropdown-toggle" type="button" data-toggle="dropdown">{{ similarity.toStr[solver.simi] }}</button><div class="dropdown-menu dropdown-menu-right"><button class="dropdown-item" type="button" v-for="(simi, simiStr) in similarity.toInt" :class="{active: simi === solver.simi}" @click="solver.simi = simi">{{ simiStr }}</button></div></div></div></div><div class="form-group mb-0"><label>可能的謎底 <span class="badge badge-pill badge-success">{{ possibilities.length }}</span></label><small class="form-text text-muted" v-if="!possibilities.length">請輸入猜測數字與結果來顯示可能的謎底</small><small class="form-text text-muted" v-if="possibilities.length &gt; 100">僅顯示前 100 筆可能的謎底</small><div id="possibilities"><a class="badge badge-info mr-1" v-for="possible in possibilities.slice(0, 100)" @click="i.guess = possible" href="#">{{ possible }}</a></div></div></div><div class="card-footer text-right"><button class="btn btn-sm btn-danger" type="button" @click="btnNewSolver(false)"><span class="fa fa-fw fa-trash-o"></span> 重新求解</button></div></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script><script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/json5@2/dist/index.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lodash@4/lodash.min.js"></script><script src="https://cdn.jsdelivr.net/npm/papaparse@5/papaparse.min.js"></script><script src="https://cdn.jsdelivr.net/npm/popper.js@1/dist/umd/popper.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-core.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1/plugins/autoloader/prism-autoloader.min.js"></script><script src="https://cdn.jsdelivr.net/npm/qs@6/dist/qs.min.js"></script><script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script><script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.min.js"></script><!-- bootstrap require jquery and pupper--><script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js"></script><script>const SIMILARITY = {
  '0A0B': 0,
  '0A1B': 1,
  '0A2B': 2,
  '0A3B': 3,
  '0A4B': 4,
  '1A0B': 10,
  '1A1B': 11,
  '1A2B': 12,
  '1A3B': 13,
  '2A0B': 20,
  '2A1B': 21,
  '2A2B': 22,
  '3A0B': 30,
  '4A0B': 40,
}
 const vm = new Vue({ // eslint-disable-line
  el: '#app',
  data: {
    i: {
      answer: '',
      guess: '',
      guesses: [],
      solvers: [],
    },
    similarity: {
      toInt: SIMILARITY,
      toStr: _.invert(SIMILARITY),
    },
  },
  mounted () {
    // 自動儲存功能
    try {
      const saved = JSON5.parse(localStorage.getItem(location.pathname))
      if (saved) this.$set(this, 'i', { ...this.i, ...saved })
    } catch (err) {}
    this.$watch('i', () => {
      localStorage.setItem(location.pathname, JSON5.stringify(this.i))
    }, { deep: true })

    // 初始化
    if (!this.verifyGuess(this.i.answer)) this.btnNewGame(true)
    if (!this.i.solvers.length) this.btnNewSolver(true)
  },
  computed: {
    possibilities () {
      const solvers = _.filter(this.i.solvers, solver => this.verifyGuess(solver.guess) && _.hasIn(this.similarity.toStr, solver.simi))
      if (!solvers.length) return []
      const possibilities = []
      for (let g1 = 0; g1 < 10; g1++) {
        for (let g2 = 0; g2 < 10; g2++) {
          if (g1 === g2) continue
          for (let g3 = 0; g3 < 10; g3++) {
            if (g3 === g1 || g3 === g2) continue
            for (let g4 = 0; g4 < 10; g4++) {
              if (g4 === g1 || g4 === g2 || g4 === g3) continue
              let isPossible = true
              const possible = `${g1}${g2}${g3}${g4}`
              for (const solver of solvers) { if (isPossible && this.calcSimilarity(possible, solver.guess) !== solver.simi) isPossible = false }
              if (isPossible) possibilities.push(possible)
            }
          }
        }
      }
      return possibilities
    },
  },
  methods: {
    verifyGuess (guess) {
      // 確認是四位數不重複的數字
      if (!_.isString(guess) || !/^\d{4}$/.test(guess)) return false
      // 確認不重複
      for (let i = 0; i < 4; i++) {
        for (let j = i + 1; j < 4; j++) { if (guess[i] === guess[j]) return false }
      }
      return true
    },
    calcSimilarity (guess, answer) {
      let similarity = 0
      for (let i = 0; i < 4; i++) {
        for (let j = 0; j < 4; j++) { if (guess[i] === answer[j]) similarity += i === j ? 10 : 1 }
      }
      return similarity
    },
    btnPushGuess () {
      const guess = this.i.guess
      if (!this.verifyGuess(guess)) return
      if (_.includes(this.i.guesses, guess)) return
      this.i.guesses.push(guess)
      this.i.guess = ''
    },
    async btnNewGame (force = false) {
      if (!force && !await this.confirm('是否開始新的猜數字遊戲？')) return
      this.i.answer = _.sampleSize('0123456789', 4).join('')
      this.i.guess = ''
      this.i.guesses = []
    },
    async btnNewSolver (force = false) {
      if (!force && !await this.confirm('是否清空求解資料？')) return
      this.$set(this.i, 'solvers', _.times(8, i => ({
        guess: '',
        simi: 0,
      })))
    },
    async btnPushSolver (guess, simi) {
      const solver = _.find(this.i.solvers, solver => !this.verifyGuess(solver.guess))
      if (!solver) return
      solver.guess = guess
      solver.simi = simi
    },
    async confirm (message, yes = '是', no = '否') {
      const confirm = await Swal.fire({
        cancelButtonColor: '#3085d6',
        cancelButtonText: no,
        confirmButtonColor: '#d33',
        confirmButtonText: yes,
        icon: 'question',
        showCancelButton: true,
        text: message,
      })
      return !!confirm.value
    },
  },
})</script></body></html>